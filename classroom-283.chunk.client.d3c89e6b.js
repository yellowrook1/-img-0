"use strict";(("undefined"!=typeof self?self:this).wpJsonpChessCom_classroom=("undefined"!=typeof self?self:this).wpJsonpChessCom_classroom||[]).push([[283],{261:function(e,t,o){o.d(t,{K:function(){return u},a:function(){return calculateArrowSlope},b:function(){return calculateArrowRotation},c:function(){return calculateArrowLength},d:function(){return d},e:function(){return getUndoMoveDetails},f:function(){return f},g:function(){return getKnightArrowRotation},h:function(){return getArrowColor},v:function(){return m}});var n=o(7144),r=Object.defineProperty,i=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,o)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;function getUndoMoveDetails(e){const t=[{animate:e.animate,from:e.kingTo||e.to,to:e.from}];var o,r;e.rookMove&&t.push((o=((e,t)=>{for(var o in t||(t={}))c.call(t,o)&&__defNormalProp(e,o,t[o]);if(s)for(var o of s(t))l.call(t,o)&&__defNormalProp(e,o,t[o]);return e})({},e.rookMove),r={from:e.rookMove.to,to:e.rookMove.from},i(o,a(r))));const d=e.captured&&e.capturedStr?{color:(0,n.D)(e.color),promoted:e.capturedPromotedPawn,square:e.EPCapturedSquare||e.to,type:e.capturedStr.toLowerCase()}:void 0;return{movedPieces:t,promotedSquare:e.promotion?e.from:void 0,restoredPiece:d}}function getArrowColor(e,t){var o,r;return null!=(r=null!=(o=e&&t[n.G.Node.Marking.JCEColorsMap[e]])?o:e)?r:t.default}const d={HEAD_HEIGHT:4.5,HEAD_WIDTH:6.5,TAIL_PADDING:4.5,WIDTH:2.75},u=27.95084971874737,f=[.5,-2],m=[2,.5,-.5,-2];function calculateArrowLength({from:e,to:t}){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function calculateArrowRotation({from:e,to:t}){const o=calculateArrowLength({from:e,to:t}),n=e.x,r=e.y+o,i=e.x-n,a=e.y-r,s=e.x-t.x,c=e.y-t.y,l=Math.acos((i*s+a*c)/o**2),d=Math.floor(l*(180/Math.PI)*100)/100;return e.x<t.x?360-d:d}function calculateArrowSlope({from:e,to:t}){const o=(e.y-t.y)/(e.x-t.x);return Number(o.toFixed(1))}function getKnightArrowRotation({from:e,slope:t,to:o}){switch(t){case 2:return e.x>o.x?180:0;case-2:return e.x>o.x?0:180;case.5:case-.5:return e.x>o.x?90:270;default:return 0}}},2283:function(e,t,o){o.r(t),o.d(t,{createRenderer:function(){return createDefaultRenderer}});var n=o(7144),r=o(261),i=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,o)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,__spreadValues=(e,t)=>{for(var o in t||(t={}))l.call(t,o)&&__defNormalProp(e,o,t[o]);if(c)for(var o of c(t))d.call(t,o)&&__defNormalProp(e,o,t[o]);return e},__spreadProps=(e,t)=>a(e,s(t));const u={a1:{x:6.25,y:93.75},a2:{x:6.25,y:81.25},a3:{x:6.25,y:68.75},a4:{x:6.25,y:56.25},a5:{x:6.25,y:43.75},a6:{x:6.25,y:31.25},a7:{x:6.25,y:18.75},a8:{x:6.25,y:6.25},b1:{x:18.75,y:93.75},b2:{x:18.75,y:81.25},b3:{x:18.75,y:68.75},b4:{x:18.75,y:56.25},b5:{x:18.75,y:43.75},b6:{x:18.75,y:31.25},b7:{x:18.75,y:18.75},b8:{x:18.75,y:6.25},c1:{x:31.25,y:93.75},c2:{x:31.25,y:81.25},c3:{x:31.25,y:68.75},c4:{x:31.25,y:56.25},c5:{x:31.25,y:43.75},c6:{x:31.25,y:31.25},c7:{x:31.25,y:18.75},c8:{x:31.25,y:6.25},d1:{x:43.75,y:93.75},d2:{x:43.75,y:81.25},d3:{x:43.75,y:68.75},d4:{x:43.75,y:56.25},d5:{x:43.75,y:43.75},d6:{x:43.75,y:31.25},d7:{x:43.75,y:18.75},d8:{x:43.75,y:6.25},e1:{x:56.25,y:93.75},e2:{x:56.25,y:81.25},e3:{x:56.25,y:68.75},e4:{x:56.25,y:56.25},e5:{x:56.25,y:43.75},e6:{x:56.25,y:31.25},e7:{x:56.25,y:18.75},e8:{x:56.25,y:6.25},f1:{x:68.75,y:93.75},f2:{x:68.75,y:81.25},f3:{x:68.75,y:68.75},f4:{x:68.75,y:56.25},f5:{x:68.75,y:43.75},f6:{x:68.75,y:31.25},f7:{x:68.75,y:18.75},f8:{x:68.75,y:6.25},g1:{x:81.25,y:93.75},g2:{x:81.25,y:81.25},g3:{x:81.25,y:68.75},g4:{x:81.25,y:56.25},g5:{x:81.25,y:43.75},g6:{x:81.25,y:31.25},g7:{x:81.25,y:18.75},g8:{x:81.25,y:6.25},h1:{x:93.75,y:93.75},h2:{x:93.75,y:81.25},h3:{x:93.75,y:68.75},h4:{x:93.75,y:56.25},h5:{x:93.75,y:43.75},h6:{x:93.75,y:31.25},h7:{x:93.75,y:18.75},h8:{x:93.75,y:6.25}},f=r.d.WIDTH/2,m=r.d.HEAD_HEIGHT,y=r.d.TAIL_PADDING,g=r.d.HEAD_WIDTH/2;function createStraightArrow({from:e,polygon:t,to:o}){const n=(0,r.b)({from:e,to:o});return t.setAttribute("transform",`rotate(${n} ${e.x} ${e.y})`),t.setAttribute("points",function getStraightArrowPoints({from:e,to:t}){const o=(0,r.c)({from:e,to:t});return`\n    ${e.x-f} ${e.y+y},\n    ${e.x-f} ${e.y+o-m},\n    ${e.x-g} ${e.y+o-m},\n    ${e.x} ${e.y+o},\n    ${e.x+g} ${e.y+o-m},\n    ${e.x+f} ${e.y+o-m},\n    ${e.x+f} ${e.y+y}\n  `.trim()}({from:e,to:o})),t}const p=r.d.WIDTH/2,h=r.d.HEAD_HEIGHT,S=r.d.TAIL_PADDING,v=r.d.HEAD_WIDTH/2;function createKnightArrow({from:e,polygon:t,slope:o,to:n}){let i=`rotate(${(0,r.g)({from:e,slope:o,to:n})} ${e.x} ${e.y})`;return r.f.includes(o)&&(i+=` scale(-1, 1) translate(-${2*e.x}, 0)`),t.setAttribute("transform",i),t.setAttribute("points",function getKnightArrowPoints({from:e}){return`\n    ${e.x-p} ${e.y+S},\n    ${e.x-p} ${e.y+25+p},\n    ${e.x+12.5-h} ${e.y+25+p},\n    ${e.x+12.5-h} ${e.y+25+v},\n    ${e.x+12.5} ${e.y+25},\n    ${e.x+12.5-h} ${e.y+25-v},\n    ${e.x+12.5-h} ${e.y+25-p},\n    ${e.x+p} ${e.y+25-p},\n    ${e.x+p} ${e.y+S}\n  `.trim()}({from:e})),t}function createArrowsMethods({board:e}){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 0 100 100"),t.classList.add("arrows"),e.addToDom({el:t,type:n.N.Arrows});const o=new Map;return{addArrows:function addArrows(e,n){e.forEach((e=>{const i=function createArrow(e,t){if(!e.key)return;const{color:o,from:n,opacity:i,to:a}=e.data,s=document.createElementNS("http://www.w3.org/2000/svg","polygon");s.setAttribute("id",`arrow-${n}${a}`),s.setAttribute("data-arrow",`${n}${a}`),s.setAttribute("class","arrow");const{arrowColors:c}=t.options;s.style.fill=(0,r.h)(o,c),i&&(s.style.opacity=String(i));const l=u[n],d=u[a];if(!l||!d)return;const f=(0,r.c)({from:l,to:d}),m=(0,r.a)({from:l,to:d});return r.v.includes(m)&&f===r.K?createKnightArrow({from:l,polygon:s,slope:m,to:d}):createStraightArrow({from:l,polygon:s,to:d})}(e,n);i&&(t.appendChild(i),o.set(e.key,i))}))},removeArrows:function removeArrows(e){e.forEach((e=>{const{key:n}=e,r=o.get(n);r&&(t.removeChild(r),o.delete(n))}))}}}function createStyleDOM({boardStyles:e,options:t,pieceStyles:o}){return updateStyles(t),{destroy:function destroy(){const e=document.getElementById(getStyleId());if(!e||!e.parentNode)return;e.parentNode.removeChild(e)},getStyleEl:getStyleEl,updateStyles:updateStyles};function getStyleEl(){return document.getElementById(getStyleId())}function getStyleId(){return t.useSharedStyleTag?"board-styles-shared":`board-styles-${t.id}`}function updateStyles(t){const r=getStyleId();let i=getStyleEl();if(!i){i=document.createElement("style"),i.type="text/css",i.id=r;const e=document.head;e&&e.appendChild(i)}const a=function getStyleInnerHTML(t){const{boardStyle:r,id:i,pieceStyle:a}=t,{path:s,format:c,isPseudo3d:l}=o[a],d=(0,n.L)(s),u=e[r],f=l?"::after":"",m=n.O.reduce(((e,t)=>`${e}#board-${i} .piece.${t}${f}, #board-${i} .promotion-piece.${t}${f} { background-image: url('${d}/${t}.${c}'); }`),"");return`\n      #board-${i}, .fade-in-overlay { background-image: url('${(0,n.K)(u[2])}'); }\n      .coordinate-light { fill: ${u[0]}; } .coordinate-dark { fill: ${u[1]}; } .highlight { background-color: ${u[4]}; }\n      ${m}\n    `}(t);i.innerHTML!==a&&(i.innerHTML=a)}}function getTextNodes(e,t){const o=function getTextChar(e){const t=["8","7","6","5","4","3","2","1","a","b","c","d","e","f","g","h"];return e?[...t.slice(0,8).reverse(),...t.slice(-8).reverse()]:t}(t),r=function getCoordinates(e){return e===n.B.CoordinatesPositions.Outside?[{color:"grey",fontSize:3.1,x:2,y:3.5},{color:"grey",fontSize:3.1,x:2,y:16},{color:"grey",fontSize:3.1,x:2,y:28.5},{color:"grey",fontSize:3.1,x:2,y:41},{color:"grey",fontSize:3.1,x:2,y:53.5},{color:"grey",fontSize:3.1,x:2,y:66},{color:"grey",fontSize:3.1,x:2,y:78.5},{color:"grey",fontSize:3.1,x:2,y:91},{color:"grey",fontSize:3.1,x:10.35,y:99.25},{color:"grey",fontSize:3.1,x:22.85,y:99.25},{color:"grey",fontSize:3.1,x:35.35,y:99.25},{color:"grey",fontSize:3.1,x:47.85,y:99.25},{color:"grey",fontSize:3.1,x:60.35,y:99.25},{color:"grey",fontSize:3.1,x:72.85,y:99.25},{color:"grey",fontSize:3.1,x:85.35,y:99.25},{color:"grey",fontSize:3.1,x:97.85,y:99.25}]:[{color:"light",fontSize:2.8,x:.75,y:3.5},{color:"dark",fontSize:2.8,x:.75,y:15.75},{color:"light",fontSize:2.8,x:.75,y:28.25},{color:"dark",fontSize:2.8,x:.75,y:40.75},{color:"light",fontSize:2.8,x:.75,y:53.25},{color:"dark",fontSize:2.8,x:.75,y:65.75},{color:"light",fontSize:2.8,x:.75,y:78.25},{color:"dark",fontSize:2.8,x:.75,y:90.75},{color:"dark",fontSize:2.8,x:10,y:99},{color:"light",fontSize:2.8,x:22.5,y:99},{color:"dark",fontSize:2.8,x:35,y:99},{color:"light",fontSize:2.8,x:47.5,y:99},{color:"dark",fontSize:2.8,x:60,y:99},{color:"light",fontSize:2.8,x:72.5,y:99},{color:"dark",fontSize:2.8,x:85,y:99},{color:"light",fontSize:2.8,x:97.5,y:99}]}(e);return r.map(((e,t)=>__spreadProps(__spreadValues({},e),{text:o[t]}))).map((e=>`<text \n          x="${e.x}" \n          y="${e.y}" \n          ${e.fontSize?`font-size="${e.fontSize}"`:""} \n          class="coordinate-${e.color}">${e.text}</text>`)).join("")}function createCoordinatesMethods({board:e,options:t}){return{setCoordinates:function setCoordinates({flipped:o,position:r}){if(removeCoordinates(),r===n.B.CoordinatesPositions.Off)return;!function addCoordinates(o,r){const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 100 100"),i.classList.add("coordinates"),o===n.B.CoordinatesPositions.Outside&&i.classList.add("outside");t.test&&(0,n.s)(i,{[n.T.Element]:n.b.Coordinates,[n.T.Flipped]:r.toString(),[n.T.Position]:o});i.innerHTML=getTextNodes(o,r),e.addToDom({el:i,type:n.N.Coordinates})}(r,o)}};function removeCoordinates(){const t=e.el.querySelector(".coordinates");t&&t.parentNode.removeChild(t)}}var x,P;function createFadeSetupMethods({board:e}){let t;return{fadeSetup:function fadeSetup({options:o}){if(0===o.fadeSetup)return void(t&&function removeFadeInOverlay(){t&&t.remove();t=void 0}());t||function createFadeInOverlay(o){t=document.createElement("div"),t.classList.add("fade-in-overlay"),e.addToDom({el:t,type:n.N.FadeSetup}),t.addEventListener("animationend",removeAnimation),o.test&&(0,n.s)(t,{[n.T.Element]:n.b.FadeInOverlay})}(o);t&&(t.style.animationDuration=o.fadeSetup/1e3+"s",t.classList.add("animate"))}};function removeAnimation(){t&&(t.style.animationDuration="",t.classList.remove("animate"))}}function generateFadeOutSteps({animation:e,numSteps:t}){return Array(t).fill(void 0).map(((o,n,r)=>{let i;let a=2.86-2.86*((n+1)/t);return a=a>1?1:a,n===r.length-1&&e.callback&&(i=e.callback),{callback:i,el:e.el,style:{opacity:a.toString()}}}))}function getCoordsFromSquare(e,t){const o=function getAbsoluteFileRankFromSan(e,t){const o=(0,n.k)(e);return t?{file:9-o.file,rank:9-o.rank}:o}(e,t);return{x:100*o.file-100,y:100*(8-o.rank)}}function generateSlideSteps({animation:e,isFlipped:t=!1,numSteps:o}){const{el:n,from:r,to:i}=e;if(!r||!i)return[];const a=getCoordsFromSquare(r,t),s=getCoordsFromSquare(i,t);if(!a||!s)return[];const c=(s.x-a.x)/o,l=(s.y-a.y)/o;return Array(o).fill(void 0).map(((e,t)=>{const r=t===o-1,i=r?s:{x:a.x+c*(t+1),y:a.y+l*(t+1)};return{el:n,style:{transform:r?"":`translate(${i.x}%, ${i.y}%)`,zIndex:r?"":"10"}}}))}(P=x||(x={}))[P.Slide=0]="Slide",P[P.FadeOut=1]="FadeOut";function createAnimations(e){let t;const o=[],r={[x.FadeOut]:generateFadeOutSteps,[x.Slide]:generateSlideSteps};return{add:function add(e,t){const{animationType:i,flipped:a}=t,s=Math.max(Math.floor(function getDuration(e){switch(e){case n.B.Animation.Types.Slow:return n.B.Animation.Speeds.Slow;case n.B.Animation.Types.Fast:return n.B.Animation.Speeds.Fast;case n.B.Animation.Types.None:return 0;default:return n.B.Animation.Speeds.Default}}(i)/16),1);e.map((e=>r[e.type]({animation:e,isFlipped:a||!1,numSteps:s}))).forEach((e=>{if(e.length>o.length){const t=Array(e.length-o.length).fill([]);o.unshift(...t)}e.forEach(((e,t,n)=>{const r=n.length-t;o[o.length-r]=[...o[o.length-r],e]}))}))},flush:function flush(){if(0===o.length)return void(t=!0);o.splice(0,o.length-1),run()},run:run};function run(){t=o.length<2;const n=o.shift();n&&(e.isAnimating()||e.setAnimatingStatus(!0),n.forEach((e=>{Object.entries(e.style).forEach((([t,o])=>{e.el.style[t]=o})),e.callback&&e.callback()})),0===o.length&&e.setAnimatingStatus(!1),t||requestAnimationFrame((()=>{run()})))}}const b="element-pool";var w,E;function createElementPool({appendTo:e,elementType:t="div",insertBefore:o,startingCount:r=0}){if(!e&&!o)throw new n.c({code:n.d.BadData,message:'When creating an element pool, you must provide an element to "appendTo" or "insertBefore".'});const i=Array(r).fill(void 0).map(createElement).map(hideElement);return{destroy:function destroy(){i.forEach((e=>{var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)})),i.length=0},get:function get(){return function showElement(e){return e.className="",e}(i.pop()||createElement())},put:function put(e){return hideElement(e),i.push(e),e}};function createElement(){var n;const r=document.createElement(t);return r.className=b,e?e.appendChild(r):null==(n=null==o?void 0:o.parentNode)||n.insertBefore(r,o),r}function hideElement(e){for(const t in e.dataset)e.dataset[t]&&(e.dataset[t]="");return e.className=b,e.style.cssText="",e}}function createPiece({details:e,el:t,emitter:o,test:r}){let i;const a=__spreadValues({},e);return t.classList.add("piece"),o.emit(w.Created,__spreadValues({},a)),setDetails(a.color,a.type),setPositionBySquare$1(a.square),r&&(0,n.s)(t,{[n.T.Element]:n.b.Piece}),{el:t,getDetails:function getDetails(){return e},setDetails:setDetails,setDraggingState:function setDraggingState(i){if(i)return t.classList.add("dragging"),o.emit(w.DragStarted,__spreadValues({},e)),void(r&&(0,n.s)(t,{[n.T.Dragging]:"true"}));r&&(0,n.s)(t,{[n.T.Dragging]:void 0});t.classList.remove("dragging"),o.emit(w.DragEnded,__spreadValues({},e))},setPositionByCoords:function setPositionByCoords(e){if(!e)return;t.style.transform=`translate(${e.x}%, ${e.y}%)`},setPositionBySquare:setPositionBySquare$1};function setDetails(a,s){t.classList.remove(i),i=function generateShortString(e,t){return`${(0,n.H)(e)}${t}`}(a,s),t.classList.add(i),e.type=s,e.color=a,o.emit(w.DetailsSet,__spreadProps(__spreadValues({},e),{shortString:i})),r&&(0,n.s)(t,{[n.T.Type]:s,[n.T.Color]:(0,n.H)(a),[n.T.ShortString]:a===n.G.ColorsAsNumbers.Black?s:s.toUpperCase()})}function setPositionBySquare$1(i,a){if(r){const e=(0,n.k)(i);if(!e)return;e&&!a&&(0,n.s)(t,{[n.T.File]:e.file.toString(),[n.T.Rank]:e.rank.toString(),[n.T.Square]:i})}(0,n.U)({el:t,square:i}),o.emit(w.PositionSetBySquare,__spreadValues({},e))}}function createPieceMovementMethods({board:e,emitter:t,options:o}){const i=function createPieces({board:e,emitter:t,options:o}){const r=createElementPool({insertBefore:e.placeholders.pieces,startingCount:32}),i=createAnimations(e);let a;const s=(0,n.X)();return{animations:i,create:function create(e){const n=createPiece({details:e,el:r.get(),emitter:t,test:o.test});return s.set(e.square,n),t.emit(w.PieceShown,__spreadValues({},s.get(e.square))),n},destroy:function destroy(){r.destroy()},get:get,getDraggingSquare:getDraggingSquare,move:function move(e,t){const o=Array.isArray(e)?e:[e],r=o.filter(Boolean).map((e=>e.kingTo||e.to)),a=o.filter(Boolean).map((e=>get(e.from))),c=[];o.forEach(((e,t)=>{if(!e)throw new n.c({code:n.d.ElementNotFound,message:"Move object does not exist."});const o=e.kingTo||e.to;o&&(a[t].setPositionBySquare(o),e.animate&&c.push({el:a[t].el,from:e.from,to:o,type:x.Slide}),s.set(o,a[t]),r.includes(e.from)||s.deleteItem(e.from),e.promotion&&s.get(o).setDetails(e.color,e.promotion))})),c.length&&i.add(c,t)},remove:function remove({animate:e,options:o,squares:c}){const l=[];c.forEach((o=>{if(!s.isDefined(o))return;const i=get(o).el;function removeElement(){if(!i)throw new n.c({code:n.d.ElementNotFound,data:{square:o},message:"Piece does not exist. Cannot remove."});r.put(i),t.emit(w.PieceHidden,o)}e?l.push({callback:removeElement,el:get(o).el,type:x.FadeOut}):removeElement(),s.deleteItem(o)})),l.length&&i.add(l,o),a&&!s.isDefined(a)&&(a=void 0)},setDraggingState:setDraggingState,setPositionByCoords:function setPositionByCoords(e,t){const o=get(e),n=getDraggingSquare();n&&setDraggingState(n,!1),o.setPositionByCoords(t)},setPositionBySquare:function setPositionBySquare2(e,t){const o=get(e);t!==e&&(s.set(t,s.get(e)),s.deleteItem(e)),o.setPositionBySquare(t)},suspendOverSquare:function suspendOverSquare(e,t){get(e).setPositionBySquare(t,!0)}};function get(e,t=!0){if(!e)return s;if(!s.isDefined(e)&&t)throw new n.c({code:n.d.ElementNotFound,data:{square:e},message:"Piece does not exist."});return s.isDefined(e)?s.get(e):void 0}function getDraggingSquare(){return a}function setDraggingState(e,t){get(e).setDraggingState(t),a=t?e:void 0}}({board:e,emitter:t,options:o});return{destroy:i.destroy,dragPiece:function dragPiece(e){if(!e)return;!document.body.classList.contains("hide-overflow")&&window.innerHeight>=document.body.scrollHeight&&document.body.classList.add("hide-overflow");e.toSquare?i.suspendOverSquare(e.square,e.toSquare):e.coords&&i.setPositionByCoords(e.square,e.coords);i.setDraggingState(e.square,!0)},dropPiece:function dropPiece(){const e=i.getDraggingSquare();if(document.body.classList.remove("hide-overflow"),!e)return;i.setPositionBySquare(e,e),i.setDraggingState(e,!1)},illegalMove:function illegalMove(e,t){if(e){const{renderer:a}=t;null==a||a.blinkHighlights([(r=e,i=o.checkBlinkingSquareColor,{data:{color:i,interval:500,opacity:.5,square:r,times:3},key:r,type:n.W})],t)}var r,i},loadPieces:function loadPieces(e,t){const o=e.pieces;i.animations.flush();const n=o.keys(),r=i.get().keys().filter((e=>!n.includes(e)));i.remove({options:t.options,squares:r}),o.keys().forEach((e=>{const t=o.get(e),n=i.get(e,!1);if(!n)return void i.create(t);const{type:r,color:a}=n.getDetails();r===t.type&&a===t.color||n.setDetails(t.color,t.type)})),i.animations.run()},makeMove:function makeMove(e,t){if(i.animations.flush(),e.drop)return void i.create({color:e.color,square:e.kingTo||e.to,type:e.piece});e.EPCapturedSquare?i.remove({animate:e.animate,options:t.options,squares:[e.EPCapturedSquare]}):i.get(e.to,!1)&&!(0,n.n)(e)&&i.remove({animate:e.animate,options:t.options,squares:[e.to]});const o=[e,e.rookMove].filter(Boolean);i.move(o,t.options),i.animations.run()},removePiece:removePiece,undoMove:function undoMove(e,t){if(i.animations.flush(),e.drop)return void removePiece(e.to,t);const{movedPieces:o,restoredPiece:a,promotedSquare:s}=(0,r.e)(e);i.move(o,t.options),a&&i.create(a);if(s){const e=i.get(s),{color:t}=e.getDetails();e.setDetails(t,n.G.Piece.Types.Pawn)}i.animations.run()}};function removePiece(e,t){i.remove({options:t.options,squares:[e]})}}function createPromotionWindowMethods({board:e,options:t}){let o,r;const i={b:void 0,n:void 0,q:void 0,r:void 0};return{closePromotionWindow:function closePromotionWindow(){if(!o)throw new n.c({code:n.d.ElementNotFound,message:"Promotion window does not exist."});o.style.display="none"},openPromotionWindow:function openPromotionWindow(a,s){const{options:{flipped:c},run:l}=s,{color:d,file:u,position:f}=function getPromotionWindowDetails({flipped:e,promotionMove:t}){let o;o=e?t.color===n.G.ColorsAsNumbers.White?"bottom":"top":t.color===n.G.ColorsAsNumbers.White?"top":"bottom";const r=t.color,i=(e?"hgfedcba":"abcdefgh").indexOf(t.to.slice(0,1))+1;return{color:r,file:i,position:o}}({flipped:c,promotionMove:a});o||function createPromotionWindow(){o=document.createElement("div"),o.classList.add("promotion-window"),t.test&&(0,n.s)(o,{[n.T.Element]:n.b.PromotionWindow});e.addToDom({el:o,type:n.N.PromotionWindow})}();r||function createCloseButton(e){r=document.createElement("i"),r.className="close-button icon-font-chess x",t.test&&(0,n.s)(r,{[n.T.Element]:n.b.PromotionCloseButton});o.appendChild(r),r.addEventListener(n.P,(t=>{t.stopPropagation(),e((0,n.q)(n.t.BoardEvents.PromotionAreaClosePointerdown))}))}(l);i.q||function createPieces2(e){Object.keys(i).forEach((r=>{const a=document.createElement("div");a.addEventListener(n.P,(t=>{t.stopPropagation(),(0,n.w)(t)?e((0,n.q)(n.t.UserEvents.PointerdownRight)):e((0,n.q)(n.t.BoardEvents.PromotionPiecePointerdown,{piece:r}))})),a.classList.add("promotion-piece"),i[r]=a,t.test&&(0,n.s)(i[r],{[n.T.Element]:n.b.PromotionPiece,[n.T.Type]:r}),o.appendChild(a)}))}(l);setPieceOrder(f),setPromotionWindowFile(u),setPieceColors(d),t.test&&(0,n.s)(o,{[n.T.Color]:(0,n.H)(d),[n.T.File]:u.toString(),[n.T.Position]:f});!function showPromotionWindow(){o.style.display=""}()}};function setPieceColors(e){Object.keys(i).forEach((o=>{i[o].className=`promotion-piece ${(0,n.H)(e)}${o}`,t.test&&(0,n.s)(i[o],{[n.T.Color]:(0,n.H)(e)})}))}function setPieceOrder(e){"top"===e?o.classList.add("top"):o.classList.remove("top")}function setPromotionWindowFile(e){o.style.transform=`translateX(${100*(e-1)}%`}}function createHighlightsMethods({board:e,options:t}){const o=createElementPool({insertBefore:e.placeholders.squares,startingCount:3}),r=(0,n.X)(),i=t.test;return{addHighlights:function addHighlights(e){e.forEach((e=>{const{square:t}=e.data;if(r.isDefined(t)||!e)return;const o=createHighlightEl(t,e);r.set(t,o)}))},blinkHighlights:function blinkHighlights(t){t.forEach((t=>{const{color:o,interval:r,opacity:a,square:s,times:c}=t.data,l=createHighlightEl(s,t);e.addToDom({el:l,type:n.N.BlinkingHighlights}),i&&(0,n.s)(l,{[n.T.Element]:n.b.BlinkingHighlight,[n.T.Square]:s,[n.T.Color]:o,[n.T.Interval]:r,[n.T.Opacity]:a,[n.T.Times]:c,[n.T.Type]:n.T.Blinking}),function blinkHighlight({el:e,interval:t,opacity:o,times:n}){let r=0,i=!0;const a=setInterval((()=>{if(r+=1,r!==2*n)i?(e.style.opacity="0",i=!1):(e.style.opacity=o.toString(),i=!0);else if(clearInterval(a),e){const t=e.parentNode;t&&t.removeChild(e)}}),t/2)}({el:l,interval:r,opacity:a,times:c})}))},removeHighlights:function removeHighlights(e){e.forEach(removeHighlight)}};function createHighlightEl(e,t){const r=o.get();return(0,n.s)(r,{[n.T.Element]:n.b.Highlight}),r.classList.add("highlight"),function updateHighlightElementStyles(e,t){if(!e)throw new n.c({code:n.d.ElementNotFound,data:{highlight:t},message:"Highlight does not exist."});const{data:{color:o,opacity:r}}=t,i=o||"",a=String(r);e.style.backgroundColor!==i&&(e.style.backgroundColor=i);e.style.opacity!==a&&(e.style.opacity=a)}(r,t),(0,n.U)({el:r,square:e}),r}function removeHighlight(e){const{square:t}=e.data;if(!r.isDefined(t))return;const n=r.get(t);o.put(n),r.deleteItem(t)}}function getPointerPosition({el:e,event:t,flipped:o}){const r=e.getBoundingClientRect(),{x:i,y:a}=(0,n.u)(t),s=r.width/8,c={x:Math.round((i-r.left)%s),y:Math.round((a-r.top)%s)},l=Math.ceil((i-r.left)/s),d=Math.ceil((r.bottom-a)/s),u=o?9-l:l,f=o?9-d:d,m=(0,n.g)({file:u,rank:f}),y={x:(i-r.left-s/2)/r.width*800,y:(a-r.top-s/2)/r.height*800},g=function getCoordsInsideBoard(e){let t=Math.max(e.x,-50);t=Math.min(t,750);let o=Math.max(e.y,-50);return o=Math.min(o,750),{x:t,y:o}}(y),p=function getSquareInsideBoard(e,t){let o=Math.max(e,1);o=Math.min(o,8);let r=Math.max(t,1);return r=Math.min(r,8),(0,n.g)({file:o,rank:r})}(u,f);return{coords:y,coordsInsideBoard:g,coordsInsideSquare:c,square:m,squareInsideBoard:p}}function createDefaultRenderer({el:e,emitter:t=(0,n.e)(),options:o=(0,n.Z)(),boardStyles:r=n.f,pieceStyles:i=n.h,testElement:a}){const s=function createBoard({el:e,options:t,testElement:o=n.b.Board}){var r;const i={[n.N.Coordinates]:document.createComment("/Coordinates"),[n.N.Squares]:document.createComment("/Squares"),[n.N.BlinkingHighlights]:document.createComment("/Blinking Highlights"),[n.N.Effects]:document.createComment("/Effects"),[n.N.HoverSquare]:document.createComment("/Hover Square"),[n.N.Pieces]:document.createComment("/Pieces"),[n.N.MoveHints]:document.createComment("/MoveHints"),[n.N.CaptureHints]:document.createComment("/Capture Hints"),[n.N.Arrows]:document.createComment("/Arrows"),[n.N.PromotionWindow]:document.createComment("/Promotion Window"),[n.N.FadeSetup]:document.createComment("/Fade Setup")};Object.values(i).forEach((t=>e.appendChild(t)));let a=(0,n.S)();return null==(r=a.resolve)||r.call(a,!0),t.test&&(0,n.s)(e,{[n.T.Element]:o}),{addToDom:function addToDom({type:t,el:o,insertAfter:n=!1}){n?e.insertBefore(o,i[t].nextSibling):e.insertBefore(o,i[t])},animationComplete:function animationComplete(e){return[n.A.All,n.A.Move].includes(e)?a.promise:Promise.resolve(!0)},el:e,flipBoard:function flipBoard(t){e.classList.toggle(n.Q.Flipped,t)},setBoardEnabled:function setBoardEnabled(){},isAnimating:function isAnimating(){return Boolean(e.dataset.testAnimating)},isFlipped:function isFlipped(){return t.flipped},placeholders:i,setAnimatingStatus:function setAnimatingStatus(t){var o;t?(e.dataset.testAnimating="true",a=(0,n.S)()):(delete e.dataset.testAnimating,null==(o=a.resolve)||o.call(a,!0))}}}({el:e,options:o,testElement:a});s.isFlipped()&&s.flipBoard(!0);const c={board:s,el:e,emitter:t,options:o},l=function createAssetsMethods({boardStyles:e,el:t,options:o,pieceStyles:r}){const i=createStyleDOM({boardStyles:e,options:o,pieceStyles:r});return{destroy:function destroy(){i.destroy()},updateBoardImage:function updateBoardImage(e){i.updateStyles(e.options)},updatePieceBaseImage:function updatePieceBaseImage(e){const{isPseudo3d:o}=r[e.options.pieceStyle];o?t.classList.add(n.Q.Pseudo3d):t.classList.remove(n.Q.Pseudo3d),i.updateStyles(e.options)}}}(__spreadProps(__spreadValues({},c),{boardStyles:r,pieceStyles:i})),d=createPieceMovementMethods(c),u=__spreadProps(__spreadValues(__spreadProps(__spreadValues(__spreadValues(__spreadValues(__spreadValues(__spreadValues(__spreadValues(__spreadValues(__spreadValues(__spreadValues(__spreadValues({},function createAnalysisOverlayMethods({board:e}){const{classList:t}=e.el;return{addAnalysisOverlay:function addAnalysisOverlay(){t.add("analysis-overlay")},removeAnalysisOverlay:function removeAnalysisOverlay(){t.remove("analysis-overlay")}}}(c)),createArrowsMethods(c)),l),createCoordinatesMethods(c)),createFadeSetupMethods(c)),function createHoverSquareMethods({board:e,options:t}){const o=function createHoverSquareEl(){const o=document.createElement("div");return o.classList.add("hover-square"),o.style.visibility="hidden",e.addToDom({el:o,type:n.N.HoverSquare}),t.test&&(0,n.s)(o,{[n.T.Element]:n.b.HoverSquare}),o}();return{hideHoverSquare:function hideHoverSquare(){o&&(o.style.visibility="hidden")},showHoverSquare:function showHoverSquare(e){o.style.visibility="",t.test&&(0,n.s)(o,{[n.T.Element]:n.b.HoverSquare}),updateHoverSquareBorder(),(0,n.U)({el:o,square:e})},updateHoverSquareBorder:updateHoverSquareBorder};function updateHoverSquareBorder(){o&&(o.style.borderWidth=`${function getBorderWidth(e){return.125*e.clientWidth*.05}(e.el)}px`)}}(c)),function createMoveHintsMethods({board:e}){const t={};return{addCaptureHints:function addCaptureHints(o){o.forEach((o=>{t[o]&&removeHint(o),t[o]=createHintFromSquare(o,{isPotentialCapture:!0}),e.addToDom({el:t[o],type:n.N.CaptureHints}),t[o].style.borderWidth=.1*t[o].clientWidth+"px"}))},addMoveHints:function addMoveHints(o){o.forEach((o=>{t[o]||(t[o]=createHintFromSquare(o),e.addToDom({el:t[o],type:n.N.MoveHints}))}))},removeHints:function removeHints(e){e.forEach(removeHint)}};function createHintFromSquare(e,t={}){const o=document.createElement("div");return(0,n.s)(o,{[n.T.Element]:t.isPotentialCapture?n.b.PotentialCapture:n.b.Hint}),o.classList.add(t.isPotentialCapture?"capture-hint":"hint"),(0,n.U)({el:o,square:e}),o}function removeHint(e){t[e]&&(t[e].parentNode.removeChild(t[e]),delete t[e])}}(c)),createHighlightsMethods(c)),createPromotionWindowMethods(c)),d),{animationComplete:s.animationComplete,createRenderer:createDefaultRenderer,destroy:function destroy(){l.destroy(),d.destroy(),e.innerHTML=""}}),t),{extendRenderer:function extendRenderer(e){Object.assign(u,e(c))},flipBoard:s.flipBoard,setBoardEnabled:s.setBoardEnabled,getCoordsFromSquare:getCoordsFromSquare,getPieces:function getPieces(){return function formatPiecesAsObject(e){const t={};return e.forEach((e=>{const o=e.className.split(" "),r=o.find((e=>e.startsWith("square-"))),i=o.find((e=>e.startsWith("w")||e.startsWith("b")));if(!r||!i)return;const[a,s]=i,c=parseInt(r[r.length-2],10),l=parseInt(r[r.length-1],10),d=(0,n.g)({file:c,rank:l});d&&(t[d]={color:(0,n.Y)(a),type:s})})),t}(Array.from(e.querySelectorAll(".piece")))},getPointerPosition:getPointerPosition,getRendererOptions:()=>({boardStyles:r,el:e,options:o,pieceStyles:i}),getBoardContainerAspectRatio:()=>1,isAnimating:s.isAnimating,name:n.R.Types.Default,resize:function resize(){u.updateHoverSquareBorder()}});return u}(E=w||(w={})).Created="Created",E.DetailsSet="DetailsSet",E.DragEnded="DragEnd",E.DragStarted="DragStart",E.PieceShown="PieceShown",E.PieceHidden="PieceHidden",E.PositionSetBySquare="PositionSetBySquare"}}]);