window.chesscom=window.chesscom||{},window.chesscom.routes=window.chesscom.routes||{},Object.assign(window.chesscom.routes,{web_classroom_room:{tokens:[["variable","/","[^/]++","id"],["text","/classroom"]],defaults:{subdomain:"www"},requirements:{subdomain:"www|schach|ru|uk|ajedrez|fr|scacchi|sakk|schaken|szachy"},hosttokens:[["text",".chess.com"],["variable","","www|schach|ru|uk|ajedrez|fr|scacchi|sakk|schaken|szachy","subdomain"]],methods:[],schemes:["https"]},web_security_login_and_go:{tokens:[["text","/login_and_go"]],defaults:{subdomain:"www"},requirements:{subdomain:"www|schach|ru|uk|ajedrez|fr|scacchi|sakk|schaken|szachy"},hosttokens:[["text",".chess.com"],["variable","","www|schach|ru|uk|ajedrez|fr|scacchi|sakk|schaken|szachy","subdomain"]],methods:[],schemes:["https"]},web_insights:{tokens:[["variable","/","[^/]++","username"],["text","/insights"]],defaults:{username:null,subdomain:"www"},requirements:{subdomain:"www|schach|ru|uk|ajedrez|fr|scacchi|sakk|schaken|szachy"},hosttokens:[["text",".chess.com"],["variable","","www|schach|ru|uk|ajedrez|fr|scacchi|sakk|schaken|szachy","subdomain"]],methods:[],schemes:["https"]}}),(("undefined"!=typeof self?self:this)["wpChessCom_-qhK"]=("undefined"!=typeof self?self:this)["wpChessCom_-qhK"]||[]).push([[468],{2259:function(e,t,n){"use strict";const s=n(7074).Z.create({withCredentials:!0});t.Z=s},5387:function(e,t,n){"use strict";n.d(t,{n:function(){return publish}});var s=n(2259);async function publish(e){var t;let n=window.PubSub.options.url[e.service||"base"];const i=e.path instanceof Array?e.path.join("/"):e.path;n.endsWith("/")||i.startsWith("/")||(n+="/");const r={};["staging","prod"].includes("staging")||(r.uid=null==(t=window.context.user)?void 0:t.uuid),e.params&&Object.assign(r,e.params);const o={};return e.requestId&&(o["x-chesscom-request-id-client"]=e.requestId),e.clientId&&(o["x-chesscom-play-client"]=e.clientId),e.headers&&Object.assign(o,e.headers),(0,s.Z)({url:/^http[s]?:/.test(i)?i:`${n}${i}`,data:e.data,method:e.method||"post",params:r,headers:o,withCredentials:!0})}},6399:function(e,t,n){"use strict";function loadLazyStyle(e){const t=document.querySelector(`link[data-href*="/${e}.client"]`);t&&(t.setAttribute("href",t.getAttribute("data-href")),t.removeAttribute("data-href"))}n.d(t,{E:function(){return loadLazyStyle}})},4164:function(e,t,n){"use strict";n.d(t,{i:function(){return getMessageFromError}});var s=n(9790);n(8160);const getMessageFromError=e=>{if(e.response&&401!==e.response.status)return(e.response.data&&e.response.data.message?e.response.data.message:s.R0.badRequest)||e.response.statusText}},9790:function(e,t,n){"use strict";n.d(t,{jC:function(){return i},R0:function(){return r},sY:function(){return o},xL:function(){return a},V5:function(){return c}});var s=n(8160);const i=7e3,r={badRequest:s.Z.trans("Oops. Looks like there was an error. Sorry! Please refresh.")},o={avatarUploaded:s.Z.trans("Avatar uploaded"),commentCreated:s.Z.trans("Thank you for your comment."),commentDeleted:s.Z.trans("Comment deleted."),commentEmptyContent:s.Z.trans("You cannot send an empty comment"),commentUpdated:s.Z.trans("Comment updated."),commentLinkCopied:s.Z.trans("Comment link is copied to clipboard"),copied:s.Z.trans("Copied to clipboard"),forumsMarkedAsRead:s.Z.trans("All forum topics have been marked as read"),featureContent:s.Z.trans("Feature Set! It might take a minute or two to appear."),inviteEmpty:s.Z.trans("Please select the players for whom to send the invitation"),inviteSent:s.Z.trans("Your invitations were sent successfully"),pgnCopied:s.Z.trans("PGN copied to buffer")},a={ALERT_FLASH_CONTAINER:"widget-alert-flash",DISMISSING:"alert-banner-dismissing"},c={error:"error",info:"info",success:"success"};c.error,r.badRequest},1302:function(e,t,n){"use strict";n.d(t,{OD:function(){return dismissAlert},C4:function(){return createAlertElement}});var s=n(9790),i=n(6399);function dismissAlert(e){const t=document.getElementById(`alert-${e}`);t&&hideAlertElement(t)}function createAlertElement(e){var t;(0,i.E)("alerts");const n=document.createElement("div");n.classList.add("alerts-alert"),n.classList.add("alerts-enter"),n.classList.add(`alerts-${e.type}`),n.setAttribute("id",`alert-${e.id}`);const r=document.createElement("span");r.classList.add("alerts-message"),r.innerHTML=e.message;const o=document.createElement("button");o.classList.add("alerts-close"),o.setAttribute("type","button"),o.innerHTML='<span class="icon-font-chess x"></span>',n.appendChild(r),n.appendChild(o),null==(t=getContainer())||t.appendChild(n),o.addEventListener("click",onClickClose),e.type===s.V5.success&&setTimeout(hideAlertElement,s.jC,n)}function getContainer(){return document.getElementById(s.xL.ALERT_FLASH_CONTAINER)}function hideAlertElement(e){e.classList.add("alerts-leave"),setTimeout(removeAlertElement,200,e)}function removeAlertElement(e){var t;try{null==(t=getContainer())||t.removeChild(e)}catch(n){!function clearAlerts(){const e=getContainer();e&&(e.innerHTML="")}()}}function onClickClose(e){var t,n;const s=null==(n=null==(t=e.target)?void 0:t.closest)?void 0:n.call(t,".alerts-alert");s&&hideAlertElement(s)}},5291:function(e,t,n){"use strict";n.d(t,{OD:function(){return s.OD},el:function(){return createAlert}});var s=n(1302),i=(n(9790),n(4752)),r=n.n(i);function createAlert({message:e,type:t,id:n}){(0,s.C4)({id:null!=n?n:r()(),type:t,message:e})}},2142:function(e,t,n){"use strict";n.r(t),n.d(t,{setupInvitations:function(){return setupInvitations}});var s=(e=>(e.ClassroomInvitation="ClassroomInvitation",e.PuzzleBattleChallenge="PuzzleBattleChallenge",e.MatcherChallenge="MatcherChallenge",e.InsightsReminder="InsightsReminder",e.SessionExpired="SessionExpired",e))(s||{}),i=n(9626),r=n(5387),o=n(4752),a=n.n(o),c=Object.defineProperty,u=Object.defineProperties,l=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;async function publish_publish(e){var t,n,s,o;return(0,r.n)((s=((e,t)=>{for(var n in t||(t={}))b.call(t,n)&&__defNormalProp(e,n,t[n]);if(d)for(var n of d(t))h.call(t,n)&&__defNormalProp(e,n,t[n]);return e})({},e),o={requestId:a()(),clientId:null==(n=(t=i.q).getClientId)?void 0:n.call(t)},u(s,l(o))))}var p=n(4164),m=n(5291);const f={notifications:[]};var w=(e=>(e[e.Toaster=0]="Toaster",e[e.Alert=1]="Alert",e))(w||{});let y=100;function delayedAction(e,t){setTimeout((()=>{e in window.toaster?(y=0,window.toaster[e](t)):(y*=2,delayedAction(e,t))}),y)}var g=window.toaster||{add(e){delayedAction("add",e)},remove(e){delayedAction("remove",e)}};function hideNotifications(e){f.notifications.filter((t=>!e||(!e.keys||e.keys.every((e=>t.keys.includes(e))))&&(!e.type||e.type===t.type)&&(!e.id||e.id===t.id))).forEach((e=>{e.type===w.Toaster?g.remove(e.id):e.type===w.Alert&&(0,m.OD)(e.id),function removeFromArray(e,t){const n=function isFunction(e){return"function"==typeof e}(t)?e.findIndex(t):e.indexOf(t);-1!==n&&e.splice(n,1)}(f.notifications,e)}))}function showNotification(e){var t,n,s,i,r,o;const c={type:null!=(t=e.type)?t:w.Alert,keys:null!=(n=e.keys)?n:[],id:a()()};e.unique&&hideNotifications({type:e.type,keys:e.keys}),e.duration&&setTimeout(hideNotifications,e.duration,{id:c.id}),c.type===w.Toaster?null==(r=g)||r.add({id:c.id,duration:e.duration,content:null!=(s=e.content)?s:"",theme:null!=(i=e.theme)?i:"info",icon:e.icon,links:e.links,avatarUrl:e.avatarUrl}):c.type===w.Alert&&(0,m.el)({id:c.id,type:e.theme||"info",message:null!=(o=e.content)?o:""}),f.notifications.push(c)}var v=Object.defineProperty,C=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,show_alert_defNormalProp=(e,t,n)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function showAlert(e){showNotification(((e,t)=>{for(var n in t||(t={}))k.call(t,n)&&show_alert_defNormalProp(e,n,t[n]);if(C)for(var n of C(t))A.call(t,n)&&show_alert_defNormalProp(e,n,t[n]);return e})({type:w.Alert},e))}function showHttpError(e){!function showError(e){showAlert({duration:1e4,theme:"error",content:e})}((0,p.i)(e))}var z=Object.defineProperty,S=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,show_toaster_defNormalProp=(e,t,n)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function showToaster(e){showNotification(((e,t)=>{for(var n in t||(t={}))O.call(t,n)&&show_toaster_defNormalProp(e,n,t[n]);if(S)for(var n of S(t))P.call(t,n)&&show_toaster_defNormalProp(e,n,t[n]);return e})({type:w.Toaster},e))}var E=n(2305),I=n(425);function handleClassroomMessage({message:e}){e.added.forEach((e=>{!function showClassroomInvitation(e){const t=(0,E.dW)("%username% invited you to Classroom",{"%username%":e.creator.username});showToaster({keys:[s.ClassroomInvitation,e.id],icon:"chess-board",duration:0,avatarUrl:e.creator.avatarUrl,content:t,links:[{label:(0,E.dW)("Decline"),onClick:async()=>{try{await publish_publish({path:e.decline})}catch(t){showHttpError(t)}}},{label:(0,E.dW)("Accept"),onClick:async()=>{try{const{data:{sessionId:t}}=await publish_publish({path:e.accept});window.location.href=I.Z.generate("web_classroom_room",{id:t},!0)}catch(t){showHttpError(t)}}}]})}(e)})),e.removed.forEach((e=>{!function hideClassroomInvitation(e){hideNotifications({keys:[s.ClassroomInvitation,e.id]})}(e)}))}var j=n(3694),T=n(8508),_=n(7080);Object.create,Object.defineProperty,Object.getOwnPropertyDescriptor,Object.getOwnPropertyNames,Object.getPrototypeOf,Object.prototype.hasOwnProperty;function getSubscriptionChannel(e){return function isString(e){return"string"==typeof e}(e)?e:e.join("/")}function isAlternativePubSub(e){return Boolean(e&&"/pubsub"!==e&&"/pubsub/"!==e)}function getSubscriptionKey({channel:e,pubsub:t}){return isAlternativePubSub(t)?`${t}$${getSubscriptionChannel(e)}`:getSubscriptionChannel(e)}var x=n(3379);class SubscriptionError extends Error{constructor(e,t){super(`failed to subscribe to ${e} (code: ${null==t?void 0:t.code})`),this.channel=e,this.failure=t}}function unsubscribePubSubChannel(e){var t;const n=getSubscriptionKey(e);if(null==(t=_.z.subscriptions[n])||t.close(),delete _.z.subscriptions[n],delete _.z.subscribing[n],!isAlternativePubSub(e.pubsub))return;!Object.keys(_.z.subscriptions).filter((t=>t.split("$")[0]===e.pubsub)).length&&_.z.clients[e.pubsub]&&(_.z.clients[e.pubsub].close(),delete _.z.clients[e.pubsub])}var L=n(6758);async function subscribePubSubChannel(e){if(_.z.waitingForClient)return _.z.waitingForClient;isAlternativePubSub(e.pubsub)?await async function connectPubSubClient(e){return e in _.z.connecting?_.z.connecting[e]:_.z.clients[e]?void 0:(_.z.connecting[e]=new Promise(((t,s)=>{var i,r;const o={debug:!1,maxReconnectionDelayMs:5e3,reconnectionDelayPowBase:1.3,uid:null==(r=null==(i=window.context)?void 0:i.user)?void 0:r.uuid,url:window.PubSub.options.url.pubsub.replace(/\/pubsub$/,e)},a={onAttach:()=>{delete _.z.connecting[e],t()},onConnect:()=>{delete _.z.connecting[e],t()},onDetach:()=>{delete _.z.connecting[e],delete _.z.clients[e],s()},onFailure:t=>{delete _.z.connecting[e],delete _.z.clients[e],s(t)}};n.e(401).then(n.bind(n,9401)).then((({default:t})=>{_.z.clients[e]=t.connect(o,a)}))})),_.z.connecting[e])}(e.pubsub):(0,x.X)()||await(0,L.B)();const t=getSubscriptionKey(e);return t in _.z.subscribing?_.z.subscribing[t]:_.z.subscriptions[t]?void 0:(_.z.subscribing[t]=new Promise(((n,s)=>{const i=getSubscriptionChannel(e.channel),r=isAlternativePubSub(e.pubsub)?_.z.clients[e.pubsub]:j.pS,o=setTimeout((()=>{t in _.z.subscribing&&((0,T.T)("time out while subscribing to PubSub",{channel:i}),unsubscribePubSubChannel({channel:i,pubsub:e.pubsub}))}),3e4),a=r.subscribe(i,{onDetach(){clearTimeout(o)},onAttach(){clearTimeout(o),delete _.z.subscribing[t],_.z.subscriptions[t]=a,n()},onFailure(e){clearTimeout(o),delete _.z.subscribing[t],s(new SubscriptionError(i,e))},onMessage(t){i in _.z.subscribing&&(0,T.T)("onMessage PubSub hook fired before onAttach",{channel:i}),Promise.resolve({channel:i,message:t}).then(e.onMessage)},onComplete(){clearTimeout(o),unsubscribePubSubChannel({channel:i,pubsub:e.pubsub}),n()}})})),_.z.subscribing[t])}async function subscribeAuthenticatedChannel(e,t){var n;try{await function subscribeChannel(e,t){return subscribePubSubChannel({channel:e,onMessage:t})}(e,t)}catch(i){if(401!==(null==(n=i.failure)?void 0:n.code))throw i;!function showSessionExpired(){showToaster({keys:[s.SessionExpired],unique:!0,icon:"circle-danger",duration:0,content:(0,E.dW)("Looks like youâ€™re logged out!"),links:[{label:(0,E.dW)("Please log back in"),onClick:()=>{window.location.href=I.Z.generate("web_security_login_and_go",{returnUrl:window.location.href})}}]})}()}}function showInsightsReminder(){showToaster({keys:[s.InsightsReminder],unique:!0,icon:"lightbulb",duration:0,content:(0,E.dW)("Your insights are ready!"),links:[{label:(0,E.dW)("Click here to see them now"),onClick:()=>{const e=new URL(I.Z.generate("web_insights",{},!0));e.searchParams.set("toaster","true"),window.location.href=e.toString()}}]})}function setupInvitations(){!async function subscribeClassroom(){return subscribeAuthenticatedChannel([j.AM.Invitations,j.jq.Users,":me"],handleClassroomMessage)}(),async function subscribeInsights(){if(window.location.pathname===I.Z.generate("web_insights"))return;return subscribeAuthenticatedChannel([j.AM.Insights,"backfilling",window.context.user.uuid],showInsightsReminder)}()}},4752:function(e){e.exports=function uid(e){return e=e||7,Math.random().toString(35).substr(2,e)}}}]);